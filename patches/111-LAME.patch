--- LAME-3.99.5-orig/configure	2012-02-29 02:54:37.000000000 +0800
+++ LAME-3.99.5/configure	2017-04-01 16:36:40.113394900 +0800
@@ -11922,7 +11922,7 @@
 		 sys/soundcard.h \
 		 sys/time.h \
 		 unistd.h \
-		 xmmintrin.h \
+		 $check_xmmintrin \
 		 linux/soundcard.h
 do :
   as_ac_Header=`$as_echo "ac_cv_header_$ac_header" | $as_tr_sh`
@@ -17290,7 +17290,14 @@
     ofile='$ofile'
 
 
-
+case $host_cpu in
+powerpc*|i686*)
+    check_xmmintrin=
+    ;;
+*)
+    check_xmmintrin="xmmintrin.h"
+    ;;
+esac
 
 _ACEOF
 
@@ -17385,7 +17385,7 @@
 fi
 ac_cs_awk_cr=`$AWK 'BEGIN { print "a\rb" }' </dev/null 2>/dev/null`
 if test "$ac_cs_awk_cr" = "a${ac_cr}b"; then
-  ac_cs_awk_cr='\\r'
+  ac_cs_awk_cr='\r'
 else
   ac_cs_awk_cr=$ac_cr
 fi
--- LAME-3.99.5-orig/configure.in	2014-04-30 16:21:08.328453700 +0000
+++ LAME-3.99.5/configure.in	2014-04-30 16:21:39.141366400 +0000
@@ -392,7 +392,7 @@
 
 dnl configure use of features
 
-AM_PATH_GTK(1.2.0, HAVE_GTK="yes", HAVE_GTK="no")
+AC_SUBST(GTK_CFLAGS,[])
 
 dnl ElectricFence malloc debugging
 AC_MSG_CHECKING(use of ElectricFence malloc debugging)
--- LAME-3.99.5-orig/frontend/parse.c
+++ LAME-3.99.5/frontend/parse.c
@@ -372,11 +372,11 @@
     const char *b = get_lame_os_bitness();
     const char *v = get_lame_version();
     const char *u = get_lame_url();
-    const size_t lenb = strlen(b);
-    const size_t lenv = strlen(v);
-    const size_t lenu = strlen(u);
-    const size_t lw = 80;       /* line width of terminal in characters */
-    const size_t sw = 16;       /* static width of text */
+    const unsigned int lenb = strlen(b);
+    const unsigned int lenv = strlen(v);
+    const unsigned int lenu = strlen(u);
+    const unsigned int lw = 80;       /* line width of terminal in characters */
+    const unsigned int sw = 16;       /* static width of text */
 
     if (lw >= lenb + lenv + lenu + sw || lw < lenu + 2)
         /* text fits in 80 chars per line, or line even too small for url */
Description: Fix race condition causing build failures on i386.
Origin: http://git.debian.org/?p=pkg-multimedia/lame.git;a=blob;f=debian/patches/parallel-builds-fix.patch

--- LAME-3.99.5-orig/libmp3lame/i386/Makefile.am
+++ LAME-3.99.5/libmp3lame/i386/Makefile.am
@@ -15,6 +15,7 @@
 if HAVE_NASM
 noinst_LTLIBRARIES = liblameasmroutines.la
 liblameasmroutines_la_SOURCES = $(nasm_sources)
+liblameasmroutines_la_DEPENDENCIES = $(nasm_sources:.nas.lo)
 am_liblameasmroutines_la_OBJECTS = \
 	choose_table$U.lo \
 	cpu_feat$U.lo \
@@ -53,11 +54,10 @@
 	$(NASM) $(NASMFLAGS) $< -o $@ -l $@.lst
 
 .nas.lo: $< nasm.h
-	mkdir -p .libs
 	$(ECHO) '# Generated by ltmain.sh - GNU libtool 1.5.22 (1.1220.2.365 2005/12/18 22:14:06)' >$@
-	$(ECHO) "pic_object='.libs/$*.o'" >>$@
-	$(ECHO) "non_pic_object='.libs/$*.o'" >>$@
-	$(NASM) $(NASMFLAGS) $< -o .libs/$*.o -l $@.lst
+	$(ECHO) "pic_object='$*.o'" >>$@
+	$(ECHO) "non_pic_object='$*.o'" >>$@
+	$(NASM) $(NASMFLAGS) $< -o $*.o -l $@.lst
 
 COMPILE = $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) \
 	$(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS)
--- LAME-3.99.5-orig/libmp3lame/i386/Makefile.in
+++ LAME-3.99.5/libmp3lame/i386/Makefile.in
@@ -218,6 +218,7 @@
 
 @HAVE_NASM_TRUE@noinst_LTLIBRARIES = liblameasmroutines.la
 @HAVE_NASM_TRUE@liblameasmroutines_la_SOURCES = $(nasm_sources)
+@HAVE_NASM_TRUE@liblameasmroutines_la_DEPENDENCIES = $(nasm_sources:.nas.lo)
 @HAVE_NASM_TRUE@am_liblameasmroutines_la_OBJECTS = \
 @HAVE_NASM_TRUE@	choose_table$U.lo \
 @HAVE_NASM_TRUE@	cpu_feat$U.lo \
@@ -526,11 +527,10 @@
 	$(NASM) $(NASMFLAGS) $< -o $@ -l $@.lst
 
 .nas.lo: $< nasm.h
-	mkdir -p .libs
 	$(ECHO) '# Generated by ltmain.sh - GNU libtool 1.5.22 (1.1220.2.365 2005/12/18 22:14:06)' >$@
-	$(ECHO) "pic_object='.libs/$*.o'" >>$@
-	$(ECHO) "non_pic_object='.libs/$*.o'" >>$@
-	$(NASM) $(NASMFLAGS) $< -o .libs/$*.o -l $@.lst
+	$(ECHO) "pic_object='$*.o'" >>$@
+	$(ECHO) "non_pic_object='$*.o'" >>$@
+	$(NASM) $(NASMFLAGS) $< -o $*.o -l $@.lst
 
 #$(OBJECTS): libtool
 #libtool: $(LIBTOOL_DEPS)
